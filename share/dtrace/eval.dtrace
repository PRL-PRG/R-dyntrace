#!/usr/sbin/dtrace -Zs 

#pragma D option quiet

self int depth;

dtrace:::BEGIN
{
	printf("   %4s %s\n", "SEXP", "CODE");
}

R*:::eval-expression
{
    printf("%*s-> %4d %s\n", self->depth * 2, "", arg0, copyinstr(arg1));
    
    self->depth++;
}

R*:::eval-return
{
    self->depth -= self->depth > 0 ? 1 : 0;

    printf("%*s<- %4d %s\n", self->depth * 2, "", arg0, copyinstr(arg1));
}